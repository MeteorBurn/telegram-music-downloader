# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ø–∞–ø–æ–∫ –∏ —Ç—Ä–µ–∫–µ—Ä–æ–≤

## –ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π

–¢–µ–ø–µ—Ä—å –∫–∞–∂–¥—ã–π Telegram –∫–∞–Ω–∞–ª/–≥—Ä—É–ø–ø–∞ –∏–º–µ–µ—Ç —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—É—é –ø–∞–ø–∫—É –¥–ª—è –∑–∞–≥—Ä—É–∑–æ–∫ –∏ –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã —Ç—Ä–µ–∫–µ—Ä–æ–≤. –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç:
- –û—Ä–≥–∞–Ω–∏–∑–æ–≤–∞–Ω–Ω–æ —Ö—Ä–∞–Ω–∏—Ç—å —Ñ–∞–π–ª—ã –∏–∑ —Ä–∞–∑–Ω—ã—Ö –∫–∞–Ω–∞–ª–æ–≤
- –û—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å –∑–∞–≥—Ä—É–∑–∫–∏ –æ—Ç–¥–µ–ª—å–Ω–æ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–∞–Ω–∞–ª–∞
- –õ–µ–≥–∫–æ —É–ø—Ä–∞–≤–ª—è—Ç—å –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º –∏–∑ –∫–∞–∂–¥–æ–≥–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞

## –ù–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–∞–ø–æ–∫

### –§–æ—Ä–º–∞—Ç –∏–º–µ–Ω–∏ –ø–∞–ø–∫–∏ –∫–∞–Ω–∞–ª–∞
```
{sanitized_channel_title}_{channel_id_without_minus}
```

**–ü—Ä–∏–º–µ—Ä—ã:**
- `Music_Rock_1001234567890`
- `Jazz_Classics_1009876543210`
- `Podcast_Tech_1005555555555`

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π
```
downloads/                           # –ë–∞–∑–æ–≤–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –∑–∞–≥—Ä—É–∑–æ–∫ (–∏–∑ config.yaml)
‚îú‚îÄ‚îÄ Music_Rock_1001234567890/       # –ü–∞–ø–∫–∞ –ø–µ—Ä–≤–æ–≥–æ –∫–∞–Ω–∞–ª–∞
‚îÇ   ‚îú‚îÄ‚îÄ song1.mp3
‚îÇ   ‚îú‚îÄ‚îÄ song2.mp3
‚îÇ   ‚îú‚îÄ‚îÄ message_tracker.json        # –¢—Ä–µ–∫–µ—Ä –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
‚îÇ   ‚îî‚îÄ‚îÄ file_tracker.json           # –¢—Ä–µ–∫–µ—Ä —Å–∫–∞—á–∞–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
‚îú‚îÄ‚îÄ Jazz_Classics_1009876543210/    # –ü–∞–ø–∫–∞ –≤—Ç–æ—Ä–æ–≥–æ –∫–∞–Ω–∞–ª–∞
‚îÇ   ‚îú‚îÄ‚îÄ track1.mp3
‚îÇ   ‚îú‚îÄ‚îÄ track2.mp3
‚îÇ   ‚îú‚îÄ‚îÄ message_tracker.json
‚îÇ   ‚îî‚îÄ‚îÄ file_tracker.json
‚îî‚îÄ‚îÄ Podcast_Tech_1005555555555/     # –ü–∞–ø–∫–∞ —Ç—Ä–µ—Ç—å–µ–≥–æ –∫–∞–Ω–∞–ª–∞
    ‚îú‚îÄ‚îÄ episode1.mp3
    ‚îú‚îÄ‚îÄ episode2.mp3
    ‚îú‚îÄ‚îÄ message_tracker.json
    ‚îî‚îÄ‚îÄ file_tracker.json
```

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–º–µ–Ω–∏ –ø–∞–ø–∫–∏

–§—É–Ω–∫—Ü–∏—è `channel_utils.py::sanitize_channel_name()` –≤—ã–ø–æ–ª–Ω—è–µ—Ç:
1. **–¢—Ä–∞–Ω—Å–ª–∏—Ç–µ—Ä–∞—Ü–∏—è –∫–∏—Ä–∏–ª–ª–∏—Ü—ã** - —Ä—É—Å—Å–∫–∏–µ –±—É–∫–≤—ã –ø—Ä–µ–æ–±—Ä–∞–∑—É—é—Ç—Å—è –≤ –ª–∞—Ç–∏–Ω–∏—Ü—É
2. **–£–¥–∞–ª–µ–Ω–∏–µ —ç–º–æ–¥–∑–∏** - –≤—Å–µ emoji —Å–∏–º–≤–æ–ª—ã —É–±–∏—Ä–∞—é—Ç—Å—è
3. **–ó–∞–º–µ–Ω–∞ –Ω–µ–¥–æ–ø—É—Å—Ç–∏–º—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤** - —Å–∏–º–≤–æ–ª—ã, –∑–∞–ø—Ä–µ—â–µ–Ω–Ω—ã–µ –≤ —Ñ–∞–π–ª–æ–≤—ã—Ö —Å–∏—Å—Ç–µ–º–∞—Ö, –∑–∞–º–µ–Ω—è—é—Ç—Å—è –Ω–∞ `_`
4. **–û—á–∏—Å—Ç–∫–∞ –æ—Ç –ø—Ä–æ–±–µ–ª–æ–≤** - –ª–∏—à–Ω–∏–µ –ø—Ä–æ–±–µ–ª—ã —É–¥–∞–ª—è—é—Ç—Å—è

### –§–æ—Ä–º–∞—Ç channel_id

–ò–∑ ID –∫–∞–Ω–∞–ª–∞ —É–¥–∞–ª—è—é—Ç—Å—è:
- –ü—Ä–µ—Ñ–∏–∫—Å `-` (–¥–ª—è –≥—Ä—É–ø–ø/–∫–∞–Ω–∞–ª–æ–≤)
- –ü—Ä–µ—Ñ–∏–∫—Å `@` (–¥–ª—è –ø—É–±–ª–∏—á–Ω—ã—Ö –∫–∞–Ω–∞–ª–æ–≤)

–†–µ–∑—É–ª—å—Ç–∞—Ç: —Ç–æ–ª—å–∫–æ —á–∏—Å–ª–æ–≤–∞—è —á–∞—Å—Ç—å ID (–Ω–∞–ø—Ä–∏–º–µ—Ä, `1001234567890`)

## –¢—Ä–µ–∫–µ—Ä—ã

### Message Tracker
**–§–∞–π–ª:** `message_tracker.json`

**–°–æ–¥–µ—Ä–∂–∏–º–æ–µ:**
```json
{
  "channel_id": "1001234567890",
  "processed_messages": [101, 102, 103, 104, 105],
  "last_processed_id": 105
}
```

### File Tracker
**–§–∞–π–ª:** `file_tracker.json`

**–°–æ–¥–µ—Ä–∂–∏–º–æ–µ:**
```json
{
  "channel_id": "1001234567890",
  "downloaded_files": {
    "101": {
      "message_id": 101,
      "filename": "song.mp3",
      "file_path": "/path/to/downloads/Music_Rock_1001234567890/song.mp3",
      "file_hash": "abc123...",
      "file_size": 5242880,
      "download_date": "2025-01-01T12:00:00"
    }
  },
  "blacklisted_files": {}
}
```

## –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥–µ

### –ù–æ–≤—ã–µ –º–æ–¥—É–ª–∏
- **`channel_utils.py`** - —É—Ç–∏–ª–∏—Ç—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ø–∞–ø–∫–∞–º–∏ –∫–∞–Ω–∞–ª–æ–≤:
  - `sanitize_channel_name()` - –æ—á–∏—Å—Ç–∫–∞ –∏–º–µ–Ω–∏ –∫–∞–Ω–∞–ª–∞
  - `format_channel_id()` - —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ ID –∫–∞–Ω–∞–ª–∞
  - `create_channel_folder_name()` - —Å–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª–Ω–æ–≥–æ –∏–º–µ–Ω–∏ –ø–∞–ø–∫–∏
  - `get_channel_downloads_dir()` - –ø–æ–ª—É—á–µ–Ω–∏–µ –ø—É—Ç–∏ –∫ –ø–∞–ø–∫–µ –∑–∞–≥—Ä—É–∑–æ–∫ –∫–∞–Ω–∞–ª–∞
  - `get_channel_tracker_path()` - –ø–æ–ª—É—á–µ–Ω–∏–µ –ø—É—Ç–∏ –∫ —Ñ–∞–π–ª—É —Ç—Ä–µ–∫–µ—Ä–∞

### –ò–∑–º–µ–Ω—ë–Ω–Ω—ã–µ –º–æ–¥—É–ª–∏

#### `tracker.py`
- **`MessageTracker`** - —Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∫–∞–Ω–∞–ª–∞
  - –ü—Ä–∏–Ω–∏–º–∞–µ—Ç `channel_id` –≤ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–µ
  - –ú–µ—Ç–æ–¥—ã –±–æ–ª—å—à–µ –Ω–µ —Ç—Ä–µ–±—É—é—Ç `channel_id` –≤ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞—Ö
  
- **`FileTracker`** - —Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∫–∞–Ω–∞–ª–∞
  - –ü—Ä–∏–Ω–∏–º–∞–µ—Ç `channel_id` –≤ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–µ
  - –ú–µ—Ç–æ–¥—ã —É–ø—Ä–æ—â–µ–Ω—ã (–Ω–µ —Ç—Ä–µ–±—É—é—Ç `channel_id`)
  
- **`TrackerManager`** - –Ω–æ–≤—ã–π –∫–ª–∞—Å—Å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç—Ä–µ–∫–µ—Ä–∞–º–∏
  - –°–æ–∑–¥–∞—ë—Ç –∏ –∫—ç—à–∏—Ä—É–µ—Ç —Ç—Ä–µ–∫–µ—Ä—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–∞–Ω–∞–ª–∞
  - –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –º–µ—Ç–æ–¥—ã –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø—É—Ç–µ–π

#### `downloader.py`
- **`TelegramDownloader.__init__`** - `file_tracker` —Ç–µ–ø–µ—Ä—å –æ–ø—Ü–∏–æ–Ω–∞–ª–µ–Ω
- **`download_media_file()`** - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `file_tracker` –∏–∑ `media_info['file_tracker']`
- –ü–∞–ø–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –±–µ—Ä—ë—Ç—Å—è –∏–∑ `media_info['download_dir']`

#### `main.py`
- –í–º–µ—Å—Ç–æ –≥–ª–æ–±–∞–ª—å–Ω—ã—Ö —Ç—Ä–µ–∫–µ—Ä–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `TrackerManager`
- –í `_process_channel_concurrent()` –∏ `_process_channel()`:
  - –°–æ–∑–¥–∞—é—Ç—Å—è —Ç—Ä–µ–∫–µ—Ä—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–∞–Ω–∞–ª–∞ —á–µ—Ä–µ–∑ `TrackerManager`
  - –í `media_info` –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –ø–æ–ª—è:
    - `file_tracker` - —Ç—Ä–µ–∫–µ—Ä —Ñ–∞–π–ª–æ–≤ –¥–ª—è –∫–∞–Ω–∞–ª–∞
    - `download_dir` - –ø–∞–ø–∫–∞ –∑–∞–≥—Ä—É–∑–æ–∫ –¥–ª—è –∫–∞–Ω–∞–ª–∞

## –ú–∏–≥—Ä–∞—Ü–∏—è —Å–æ —Å—Ç–∞—Ä–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –º–∏–≥—Ä–∞—Ü–∏—è –Ω–µ –ø—Ä–µ–¥—É—Å–º–æ—Ç—Ä–µ–Ω–∞

–ï—Å–ª–∏ –≤—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ –ø—Ä–µ–¥—ã–¥—É—â—É—é –≤–µ—Ä—Å–∏—é, –≥–¥–µ –≤—Å–µ —Ñ–∞–π–ª—ã –±—ã–ª–∏ –≤ –æ–¥–Ω–æ–π –ø–∞–ø–∫–µ:

**–í–∞—Ä–∏–∞–Ω—Ç 1: –ù–∞—á–∞—Ç—å —Å —á–∏—Å—Ç–æ–≥–æ –ª–∏—Å—Ç–∞**
```bash
# –£–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—ã–µ —Ç—Ä–µ–∫–µ—Ä—ã
rm downloads/message_tracker.json
rm downloads/file_tracker.json

# –ü—Ä–æ–≥—Ä–∞–º–º–∞ —Å–æ–∑–¥–∞—Å—Ç –Ω–æ–≤—ã–µ —Ç—Ä–µ–∫–µ—Ä—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–∞–Ω–∞–ª–∞
python main.py
```

**–í–∞—Ä–∏–∞–Ω—Ç 2: –†—É—á–Ω–∞—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è**
```bash
# –°–æ–∑–¥–∞—Ç—å –ø–∞–ø–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–∞–Ω–∞–ª–∞
mkdir downloads/ChannelName1_1001234567890
mkdir downloads/ChannelName2_1009876543210

# –ü–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å —Ñ–∞–π–ª—ã –≤—Ä—É—á–Ω—É—é –ø–æ –∫–∞–Ω–∞–ª–∞–º
mv downloads/file_from_channel1.mp3 downloads/ChannelName1_1001234567890/
mv downloads/file_from_channel2.mp3 downloads/ChannelName2_1009876543210/

# –£–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—ã–µ —Ç—Ä–µ–∫–µ—Ä—ã
rm downloads/message_tracker.json
rm downloads/file_tracker.json
```

## –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

### –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å
‚ùå **–û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç** - —Å—Ç–∞—Ä—ã–µ —Ç—Ä–µ–∫–µ—Ä—ã –Ω–µ –±—É–¥—É—Ç –ø—Ä–æ—á–∏—Ç–∞–Ω—ã

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è
- Python 3.8+
- –í—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏–∑ `requirements.txt`

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –Ω–æ–≤–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

1. **–û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è** - —Ñ–∞–π–ª—ã –∏–∑ —Ä–∞–∑–Ω—ã—Ö –∫–∞–Ω–∞–ª–æ–≤ –Ω–µ —Å–º–µ—à–∏–≤–∞—é—Ç—Å—è
2. **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å** - –ª–µ–≥–∫–æ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ –∫–∞–Ω–∞–ª—ã
3. **–ö–æ–Ω—Ç—Ä–æ–ª—å** - –æ—Ç–¥–µ–ª—å–Ω—ã–π –ø—Ä–æ–≥—Ä–µ—Å—Å –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–∞–Ω–∞–ª–∞
4. **–£–¥–æ–±—Å—Ç–≤–æ** - –ª–µ–≥–∫–æ –Ω–∞–π—Ç–∏ –∏ —É–ø—Ä–∞–≤–ª—è—Ç—å —Ñ–∞–π–ª–∞–º–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∫–∞–Ω–∞–ª–∞
5. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** - —É–¥–∞–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ –æ–¥–Ω–æ–≥–æ –∫–∞–Ω–∞–ª–∞ –Ω–µ –≤–ª–∏—è–µ—Ç –Ω–∞ –¥—Ä—É–≥–∏–µ

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ü–æ–ª—É—á–∏—Ç—å –ø—É—Ç—å –∫ –ø–∞–ø–∫–µ –∫–∞–Ω–∞–ª–∞
```python
from channel_utils import get_channel_downloads_dir
from pathlib import Path

base_dir = Path("/path/to/downloads")
channel_title = "Music & Rock üé∏"
channel_id = "-1001234567890"

channel_dir = get_channel_downloads_dir(base_dir, channel_title, channel_id)
print(channel_dir)
# Output: /path/to/downloads/Music_Rock_1001234567890
```

### –ü–æ–ª—É—á–∏—Ç—å –ø—É—Ç—å –∫ —Ç—Ä–µ–∫–µ—Ä—É
```python
from channel_utils import get_channel_tracker_path
from pathlib import Path

base_dir = Path("/path/to/downloads")
channel_title = "Jazz Classics"
channel_id = "1009876543210"

message_tracker_path = get_channel_tracker_path(
    base_dir, channel_title, channel_id, 'message'
)
print(message_tracker_path)
# Output: /path/to/downloads/Jazz_Classics_1009876543210/message_tracker.json
```

### –°–æ–∑–¥–∞—Ç—å —Ç—Ä–µ–∫–µ—Ä –¥–ª—è –∫–∞–Ω–∞–ª–∞
```python
from tracker import create_message_tracker, create_file_tracker

channel_id = "1001234567890"
tracker_file = "/path/to/Music_Rock_1001234567890/message_tracker.json"

message_tracker = create_message_tracker(tracker_file, channel_id)
message_tracker.mark_message_processed(101)
```

## –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –ø–∞–ø–∫–µ `downloads/`
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Å—Ç–∞—Ä—ã–µ —Ç—Ä–µ–∫–µ—Ä—ã —É–¥–∞–ª–µ–Ω—ã
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–¥—Ä–æ–±–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
4. –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `cleanup_tracker()` –¥–ª—è –æ—á–∏—Å—Ç–∫–∏

## –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π

**v2.0.0** - 2025-01-14
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –ø–∞–ø–æ–∫ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–∞–Ω–∞–ª–∞
- –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω `TrackerManager` –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç—Ä–µ–∫–µ—Ä–∞–º–∏
- –û–±–Ω–æ–≤–ª–µ–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ `MessageTracker` –∏ `FileTracker`
- –î–æ–±–∞–≤–ª–µ–Ω –º–æ–¥—É–ª—å `channel_utils.py` —Å —É—Ç–∏–ª–∏—Ç–∞–º–∏
